<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Calculadora de Días de Incapacidad Temporal – TEDIT</title>
<style>
  body{font-family:Arial,sans-serif;background:#f8f9fa;padding:20px}
  table{width:100%;border-collapse:collapse;margin-bottom:20px}
  th,td{border:1px solid #ccc;padding:10px;text-align:center}
  th{background:#ffc107}
  .input-green{background:#c6efce}
  .output-blue{background:#cfe2f3;font-weight:bold;font-size:1.5em;text-align:center}
  .note{color:green;font-size:.85em}
</style>
</head>
<body>
<h2>Calculadora de Días de Incapacidad Temporal – TEDIT</h2>
<table>
  <tr><th>CRITERIO</th><th>ENTRADA</th><th>FACTOR DE CORRECCIÓN</th></tr>
  <tr>
    <td>Enfermedad (CIE-10)</td>
    <td>
      <input type="text" id="busqueda" class="input-green" placeholder="Buscar…" />
      <br />
      <select id="cie" class="input-green" size="4" style="width:100%"></select>
    </td>
    <td><span id="tei">-</span></td>
  </tr>
  <tr>
    <td>Grupo de Carga</td>
    <td><select id="grupoCarga" class="input-green"></select></td>
    <td><span id="fc_ocupacion">-</span></td>
  </tr>
  <tr>
    <td>Edad</td>
    <td><input type="number" id="edad" class="input-green" min="0" max="100" value="30" /></td>
    <td><span id="fc_edad">-</span></td>
  </tr>
</table>
<h3 class="output-blue" id="resultado">TEDIT</h3>
<p class="note">* Completa solo las celdas verdes.  
** Debes ingresar los tres datos para obtener el TEDIT.</p>
<p id="detalle_calculo" style="font-weight:bold"></p>
<p id="descripcion_enfermedad"></p>
<script>
let cieData={}, edadFactor={}, gruposCarga={}, tooltipCarga={};
Promise.all([
  fetch('./cie_data.json').then(r=>r.json()).then(d=>cieData=d),
  fetch('./grupo_edad.json').then(r=>r.json()).then(d=>edadFactor=d),
  fetch('./grupos_carga.json').then(r=>r.json()).then(d=>gruposCarga=d),
  fetch('./tooltip_carga.json').then(r=>r.json()).then(d=>tooltipCarga=d)
]).then(inicializar);
function inicializar(){
  const selCarga=document.getElementById('grupoCarga');
  Object.keys(gruposCarga).forEach(k=>{
    const o=document.createElement('option');
    o.value=k;
    o.textContent=k;
    o.title=(tooltipCarga[k]||'')+'\nFactor: '+gruposCarga[k];
    selCarga.appendChild(o);
  });
  actualizarListaCIE();
  document.getElementById('busqueda').addEventListener('input', actualizarListaCIE);
  ['grupoCarga','edad','cie'].forEach(id=>{
    document.getElementById(id).addEventListener('change', actualizar)
  });
}
function actualizarListaCIE(){
  const texto=document.getElementById('busqueda').value.toLowerCase();
  const sel=document.getElementById('cie');
  sel.innerHTML='';
  for(const [desc,info] of Object.entries(cieData)){
    if(desc.toLowerCase().includes(texto)||info.codigo.toLowerCase().includes(texto)){
      const o=document.createElement('option');
      o.value=desc;
      o.textContent=`${info.codigo} – ${desc}`;
      sel.appendChild(o);
    }
  }
  actualizar();
}
function actualizar(){
  const cieKey=document.getElementById('cie').value;
  const edad=parseInt(document.getElementById('edad').value,10);
  const grupoKey=document.getElementById('grupoCarga').value;
  if(!cieKey||isNaN(edad)||!grupoKey) return;
  const cie=cieData[cieKey];
  if(!cie||!cie.codigo||!cie.grupo||!cie.tiempo) return;
  let cieCapitulo = cie.codigo.substring(0, 3);
  const esMental=grupoKey.startsWith('Mental');
  if(cieCapitulo>='F00'&&cieCapitulo<='F99'){
    if(!esMental){
      alert('Los capítulos F00–F99 permiten solamente carga Mental');
      return;
    }
  }else if(cieCapitulo>='C00'&&cieCapitulo<='D48'){
  }else{
    if(esMental){
      alert('Este diagnóstico permite solamente carga Física');
      return;
    }
  }
  const grupoEdad = edad<37 ? '18-36' : (edad<=55 ? '37-55' : '>55');
  const fcEdad = parseFloat((edadFactor[String(cie.grupo)]||{})[grupoEdad]||1);
  const fcCarga = parseFloat(gruposCarga[grupoKey]||1);
  const tedit = (cie.tiempo*fcEdad*fcCarga).toFixed(2);
  document.getElementById('fc_edad').textContent=fcEdad;
  document.getElementById('fc_ocupacion').textContent=fcCarga;
  document.getElementById('tei').textContent=cie.tiempo;
  document.getElementById('resultado').textContent=`TEDIT = ${tedit} días`;
  document.getElementById('detalle_calculo').textContent=
    `TEDIT = ${cie.tiempo} × ${fcCarga} × ${fcEdad} = ${tedit} días`;
  document.getElementById('descripcion_enfermedad').textContent=
    `Código: ${cie.codigo} — ${cieKey}`;
}
</script>

<div style="position:absolute; right:0; bottom:0; width:50%; font-size:0.85em; background:#fff; border:1px solid #ccc; padding:10px;">
<strong>GRUPO — TRABAJO HABITUAL</strong><br><br>
<b>G001</b> Directores, Gerentes, profesionales y técnicos científicos, investigadores y docentes, profesionales que realizan labor administrativa (abogados, arquitectos, trabajadoras sociales, etc.), técnicos de apoyo administrativo, secretarias, asistentes de gerencia, empleados de oficina que no atienden al público.<br><br>
<b>G002</b> Empleados de oficina que atienden el público, trabajadores de los servicios de restauración (gasfiteros, pintores, electricistas, carpinteros, etc.) y comercio, trabajadores asistenciales de los servicios de salud (médicos, enfermeras, obstetrices, tecnólogos, etc.) y cuidado de las personas, trabajadores de los servicios de protección, seguridad, limpieza.<br><br>
<b>G003</b> Trabajadores del sector agrícola, ganadero, forestal y pesquero, trabajadores asistenciales de los servicios de salud (técnicos de enfermería, camilleros, etc.) industria manufacturera, textil y de mantenimiento, conductores y operadores de maquinarias móviles.<br><br>
<b>G004</b> Operadores de instalaciones y maquinarias fijas y montadores.<br><br>
<b>G005</b> Peones de la agricultura, pesca, construcción minería y conductores de transporte pesado.
</div>
</body>
</html>


